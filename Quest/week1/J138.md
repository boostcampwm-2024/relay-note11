# Day07
## Jest 관련 오류 : 객체 비교 실패
- 원인 : 객체나 배열을 재귀적으로 값을 확인해야 함
- 해결 : toEqual을 사용
    
    ```bash
    // fn.js
    const fn = {
        add : (num1, num2) => num1 + num2,
        makeUser: (name, age) => ({name, age, gender: undefined}),
    };
    
    module.exports = fn;
    ```
    
    ```bash
    // fn.test.js
    test('이름과 나이를 전달 받아서 객체를 반환해줘', () => { // fail
        expect(fn.makeUser('Mike', 30)).toBe({
            name: 'Mike',
            age: 30,
        });
    });
    
    test('이름과 나이를 전달 받아서 객체를 반환해줘', () => { // pass
        expect(fn.makeUser('Mike', 30)).toEqual({
            name: 'Mike',
            age: 30,
        });
    });
    
    test('이름과 나이를 전달 받아서 객체를 반환해줘', () => { // fail
        expect(fn.makeUser('Mike', 30)).toStrictEqual({ // 엄격한 테스트 용
            name: 'Mike',
            age: 30,
        });
    });
    
    ```
    
    ```bash
    // fn.js
    const fn = {
        add : (num1, num2) => num1 + num2,
        makeUser: (name, age) => ({name, age, gender: undefined}),
    };
    
    module.exports = fn;
    ```
    
    ```bash
    // fn.test.js
    test('이름과 나이를 전달 받아서 객체를 반환해줘', () => { // fail
        expect(fn.makeUser('Mike', 30)).toBe({
            name: 'Mike',
            age: 30,
        });
    });
    
    test('이름과 나이를 전달 받아서 객체를 반환해줘', () => { // pass
        expect(fn.makeUser('Mike', 30)).toEqual({
            name: 'Mike',
            age: 30,
        });
    });
    
    test('이름과 나이를 전달 받아서 객체를 반환해줘', () => { // fail
        expect(fn.makeUser('Mike', 30)).toStrictEqual({ // 엄격한 테스트 용
            name: 'Mike',
            age: 30,
        });
    });
    
    ```
    

## JSON에 주석 오류 :  `//`, `#` 시도 후 오류 발생

- 원인 : 잘못된 문법 사용
- 해결 :  JSON 주석용 키 사용, "_comment"로 불려진 데이터는 앱이 JSON 데이터를 이용할때 무시함

```jsx
{
	...
	"_comment": "주석으로 사용할 내용 작성"
	...
}
```

# Day09
## worker 관련 오류 : 무한루프 발생

- 원인 : `EventManager` 클래스의 인스턴스를 `postEventAsync` 메서드에서 새로운 워커 스레드를 생성할 때마다 다시 로드
    
    ```jsx
    postEventAsync(eventName, sender, userInfo) {
        const senderJson = JSON.stringify(sender);
        new Worker(__filename, {
            workerData: { eventName, senderJson, userInfo, subscribers: JSON.stringify(this.subscribers) }
        });
    }
    ```
    
- 해결
    - 워커 스레드가 실행 중인지 확인하고, 중복 실행을 방지하는 로직을 추가
    - 워커 스레드에서 별도의 파일을 사용하지 않고 동일 파일 내에서 로직을 처리
    
    ```jsx
    postEventAsync(eventName, sender, userInfo) {
        const senderJson = JSON.stringify(sender);
        const subscribersJson = JSON.stringify(this.subscribers);
        const script = `
            const { parentPort } = require('worker_threads');
            const subscribers = ${subscribersJson};
            const sender = ${senderJson};
            const eventName = '${eventName}';
            const userInfo = ${JSON.stringify(userInfo)};
    
            subscribers.forEach(sub => {
                if ((sub.eventName === eventName || sub.eventName === "") && 
                    (sub.sender.name === sender.name || sub.sender === undefined)) {
                    new Function('return ' + sub.handler)()({ eventName, sender, userInfo });
                }
            });
    
            parentPort.close();
        `;
    
        const worker = new Worker(script, { eval: true });
    }
    ```
    

## git 오류 : 커밋 후 push가 안 됨 

- 원인 : HEAD가 Detach됨

```bash
git status
===================================
HEAD detached from 4339937
You are currently cherry-picking commit da736b9.
  (all conflicts fixed: run "git cherry-pick --continue")
  (use "git cherry-pick --skip" to skip this patch)
  (use "git cherry-pick --abort" to cancel the cherry-pick operation)
```

```bash
git branch -vv
===================================
* (HEAD detached from 4339937) da736b9 제목 수정(짝 개발코드 개선)
  main                         4339937 [origin/main] 코드 테스트 체크
```

- 해결 : main 체크아웃하고 다시 commit, push. 이하는 chatGPT 설명
    - **Detached HEAD 상태에서 작업**: `HEAD`가 브랜치가 아닌 특정 커밋을 가리킬 때는, 변경 사항이 브랜치에 적용되지 않습니다. 이 상태에서의 커밋은 브랜치에 영향을 미치지 않습니다.
    - **브랜치로 돌아가서 작업**: `main` 브랜치를 체크아웃하여 작업을 진행하면, 커밋과 푸시가 정상적으로 이루어집니다. 브랜치에서 작업한 변경 사항은 브랜치의 기록에 포함되므로, 원격 저장소에 푸시할 수 있습니다.
    
    ```bash
    git checkout main
    ```
